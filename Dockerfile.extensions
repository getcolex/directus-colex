FROM node:22-alpine

WORKDIR /app

# Install pnpm
RUN npm install -g pnpm

# Copy the entire project
COPY . .

# Install dependencies
RUN pnpm install

# Build extensions
RUN npm run extension:build

# Copy built extensions to output
RUN mkdir -p /output && \
    cp -r extensions/*/dist /output/
